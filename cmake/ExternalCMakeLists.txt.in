project(@EX_PROJ_LABEL@)

ExternalProject_Add(
    ${PROJECT_NAME}
    PREFIX ${CMAKE_CURRENT_BINARY_DIR}
    SOURCE_DIR  ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}-src
    BINARY_DIR  ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}-build-${PRESET}
    STAMP_DIR   ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}-stamp-${PRESET}
    TMP_DIR     ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}-tmp
    GIT_REPOSITORY @EX_PROJ_REPO@
    GIT_TAG @EX_PROJ_BRANCH@
    GIT_SHALLOW YES
    GIT_PROGRESS YES
    GIT_SUBMODULES_RECURSE YES
    CMAKE_ARGS "-DCMAKE_INSTALL_PREFIX:PATH=@CMAKE_INSTALL_PREFIX@/external" "-DCMAKE_BUILD_TYPE=@CMAKE_BUILD_TYPE@"
    USES_TERMINAL_DOWNLOAD YES
    USES_TERMINAL_UPDATE YES
    USES_TERMINAL_CONFIGURE YES
    USES_TERMINAL_BUILD YES
    USES_TERMINAL_INSTALL YES
)

string(TOUPPER ${PROJECT_NAME} PROJECT_NAME_UPPER)

ExternalProject_Get_Property(${PROJECT_NAME} SOURCE_DIR)
set(${PROJECT_NAME_UPPER}_SOURCE_DIR
${SOURCE_DIR}
CACHE PATH "${PROJECT_NAME_UPPER}_SOURCE_DIR"
)

ExternalProject_Get_Property(${PROJECT_NAME} BINARY_DIR)
set(${PROJECT_NAME_UPPER}_BINARY_DIR
    ${BINARY_DIR}
    CACHE PATH "${PROJECT_NAME_UPPER}_BINARY_DIR"
)

set(${PROJECT_NAME_UPPER}_INSTALL_PREFIX
${${PROJECT_NAME_UPPER}_BINARY_DIR}/install
CACHE PATH "${PROJECT_NAME_UPPER}_INSTALL_PREFIX"
)
